# backend-backend-pr-alert.yml
name: PR Review Request Notification
on:
  pull_request:
    types: [review_requested] # PRì´ ì²˜ìŒ ì—´ë ¸ì„ ë•Œë§Œ!

jobs:
  notify-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification to Reviewer
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_ID_ELLA: ${{ secrets.DISCORD_ID_ELLA }}
          DISCORD_ID_BRUNI: ${{ secrets.DISCORD_ID_BRUNI }}
        run: |
          # 1. ë¦¬ë·°ì–´ë¡œ ì§€ì •ëœ ì‚¬ëŒì˜ GitHub ì•„ì´ë”” ê°€ì ¸ì˜¤ê¸°
          REQUESTED_GITHUB_USER="${{ github.event.requested_team.name || github.event.requested_reviewer.login }}"
          
          # 2. GitHub ì•„ì´ë””ë¥¼ Discord ë©˜ì…˜ìœ¼ë¡œ ë³€í™˜ (ë§¤í•‘ ë¡œì§)
          case "$REQUESTED_GITHUB_USER" in
            "lydbsdud")
              MENTION="<@$DISCORD_ID_ELLA>"
              ;;
            "codeok2")
              MENTION="<@$DISCORD_ID_BRUNI>"
              ;;
            *)
              # ë§¤í•‘ ì•ˆ ëœ ì‚¬ëŒì´ë©´ ê·¸ëƒ¥ ë°±ì—”ë“œ íŒ€ ì „ì²´ í˜¸ì¶œ (ì•ˆì „ì¥ì¹˜)
              MENTION="@BackendTeam (ë¦¬ë·°ì–´ ë§¤í•‘ í•„ìš”)"
              ;;
          esac
          
          # 3. ë©”ì‹œì§€ ì „ì†¡
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          AUTHOR="${{ github.actor }}"

          MESSAGE="ğŸ‘€ **[ì½”ë“œ ë¦¬ë·° ìš”ì²­]**\n\n$MENTION ë‹˜! **$AUTHOR** ë‹˜ì´ ë¦¬ë·°ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.\n\nì œëª©: **$PR_TITLE**\në§í¬: $PR_URL"

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{ \"content\": \"$MESSAGE\" }" \
               $DISCORD_WEBHOOK